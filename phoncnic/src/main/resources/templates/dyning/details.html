<!DOCTYPE html>
<html lang="ko" xmls:th="http://www.thymeleaf.org">
<th:block th:replace="~{layout/dyninglayout :: setContent(~{::content})}">
    <th:block th:fragment="content">
        <h1>dyning details</h1>
        <ul>
            <li th:each="dto : ${result}">
                [[${ dto }]]
            </li>
        </ul>

<body>
    <h1>dyning details</h1>
 
    <table border="1">
        <tr>
            <th scope="col">dyningname</th>
            <th scope="col">businesshours</th>
            <th scope="col">location</th>
            <th scope="col">comment</th>
            <th scope="col">hashtag</th>
            <th scope="col">tel</th>
            <th scope="col">menu</th>
            <th scope="col">background</th>
            <th scope="col">emojicwt</th>
    
    
        </tr>
        <tr th:each="dto : ${result}" >
            <td >[[${dto.dyningname}]]</td>
            <td >[[${dto.businesshours}]]</td>
            <td >[[${dto.location}]]</td>
            <td >[[${dto.comment}]]</td>
            <td >[[${dto.hashtag}]]</td>
            <td >[[${dto.tel}]]</td>

            <td >
                <th:block th:each="idto : ${imageresult}">
                    <img th:src="|@{'/display'}?fileName=${idto.getMenuThumbnailImageURL()}|" class="thumbimage" 
                    th:data-file="|@{'/display'}?fileName=${idto.getMenuImageURL()}|"alt="">
                </th:block>
            </td>
            <td >
                <th:block th:each="idto : ${imageresult}">
                    <img th:src="|@{'/display'}?fileName=${idto.getBackgoundThumbnailImageURL()}|" class="thumbimage"
                    th:data-file="|@{'/display'}?fileName=${idto.getBackgoundImageURL()}|" alt="">
                </th:block>
            </td>
             <td >[[${dto.emojicwt}]]</td>

        </tr>
    </table>
   
    <form action="">
        <input type="hidden" name="id" value="user1@icloud.com"  readonly>
        <input type="hidden" name="dno" th:value="${result.dno}">

        <form action="">
            <input type="hidden" name="id" value="user1@icloud.com" readonly>
            <input type="hidden" name="dno" th:value="${result.dno}">
            <select name="emojitype" id="">
                <option value="1">😋</option>
                <option value="2">🥰</option>
                <option value="3">😭</option>
                <option value="4">😅</option>
                <option value="5">🥵</option>
            </select>
            <button type="button" id="emojisave">이모지 추가하기</button>
        </form>
        <table border="1">
            <tr>
                <th>이모지 갯수</th>
                <th scope="col" colspan="5">이모지 타입</th>
                <!--/* <th th:colspan="${result.emojicwt}">이모지 삭제</th> */-->
            </tr>
            <tr id="ttt">
                <td>[[${result.emojicwt}]]</td>
                <td><button class="up" value="1" name="emojitype" type="button">😋[[${emojitype1}]]</button></td>
                <td><button class="up" value="2" name="emojitype" type="button">🥰[[${emojitype2}]]</button></td>
                <td><button class="up" value="3" name="emojitype" type="button">😭[[${emojitype3}]]</button></td>
                <td><button class="up" value="4" name="emojitype" type="button">😅[[${emojitype4}]]</button></td>
                <td><button class="up" value="5" name="emojitype" type="button">🥵[[${emojitype5}]]</button></td>  
                <!--/* <td th:each="dto : ${emojilist}"><button type="button" th:value="${dto.eno}" class="emojiRemoveBtn">삭제</button></td> */-->
            </tr>
        </table>


</body>
<script  src="http://code.jquery.com/jquery-latest.min.js"></script>
<script>
     $(document).ready(function (e) {
    //이모지 제어
    var eno=localStorage.getItem("eno");
    
if(!eno){
    $(".up").click(function () {
    var id = $("input[name='id']").val();
    var dno = $("input[name='dno']").val();
    var emojitype = $(this).val();
    var next = $(this).next();
    
var data = { id: id, dno: dno, emojitype:emojitype};
       var urlemojiregister = `[[@{/dyning/emojiregister}]]`;
        console.log(data);
$.ajax({
    url: urlemojiregister + "/" + dno,
    type: "POST",
    data: JSON.stringify(data),
    contentType: "application/json; charset=utf-8",
    dataType: "text",
    success: function (result) {
        console.log("result: " + result);
        localStorage.setItem("eno", result);
        self.location.reload();
    }
})

});
}else{

    $(".up").click( function(){
        var eno =localStorage.getItem("eno");
        var data = {eno:eno};
        // $(this).toggleClass("down");
        // $("button[name='emojitype']").toggleClass("up");
        console.log(data);
        var urlemojiremove = `[[@{/dyning/emojiremove}]]`;
        $.ajax({
            url: urlemojiremove +"/"+ eno,
            type: "DELETE",
            data: JSON.stringify(data),
            contentType: "application/json; charset=utf-8",
            dataType: "text",
            success: function (result) {
                console.log("result: " + result);
                self.location.reload();
                localStorage.clear();
        }
        })
    });
}
//모달제어
                $(".btn-close").on("click", function(e){
                $("#imageModal").hide();
                });
                $(".thumbimage").on("click", function(e){
                        var filename = $(this).data('file');
                        console.log(filename);
                        var OriginMenu=`<img style="width:100%" src="${filename}">`;
                        $(".modal-body").html(OriginMenu);
                        $("#imageModal").show();
                 });
                 $("button[name='btn-close']").on("click", function(e){
                $("#imageModal").hide();
                });
                });

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

<div id="imageModal" class="modal imageModal" tabindex="-2">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Picture</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" name="btn-close"></button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary pictureClose" name="btn-close"
                    data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
</html>
