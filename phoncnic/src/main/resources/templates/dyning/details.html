<!DOCTYPE html>
<html lang="ko" xmls:th="http://www.thymeleaf.org">
<th:block th:replace="~{layout/dyninglayout :: setContent(~{::content})}">
    <th:block th:fragment="content">
        <h1>dyning details</h1>
        <ul>
            <li th:each="dto : ${result}">
                [[${ dto }]]
            </li>
        </ul>

        <table border="1">
            <tr>
                <th scope="col">dyningname</th>
                <th scope="col">businesshours</th>
                <th scope="col">location</th>
                <th scope="col">comment</th>
                <th scope="col">hashtag</th>
                <th scope="col">tel</th>
                <th scope="col">menu</th>
                <th scope="col">background</th>
                <th scope="col">emojicwt</th>
            </tr>
            <tr th:each="dto : ${result}">
                <td>[[${dto.dyningname}]]</td>
                <td>[[${dto.businesshours}]]</td>
                <td>[[${dto.location}]]</td>
                <td>[[${dto.comment}]]</td>
                <td>[[${dto.hashtag}]]</td>
                <td>[[${dto.tel}]]</td>
                <td>
                    <th:block th:each="idto : ${imageresult}">[[${idto.menuimagepath}]],</th:block>
                </td>
                <td>
                    <th:block th:each="idto : ${imageresult}">[[${idto.backgroundpath}]],</th:block>
                </td>
                <td>[[${dto.emojicwt}]]</td>
            </tr>
        </table>

        <form action="">
            <input type="hidden" name="id" value="user1@icloud.com" readonly>
            <input type="hidden" name="dno" th:value="${result.dno}">
            <select name="emojitype" id="">
                <option value="1">😋</option>
                <option value="2">🥰</option>
                <option value="3">😭</option>
                <option value="4">😅</option>
                <option value="5">🥵</option>
            </select>
            <button type="button" id="emojisave">이모지 추가하기</button>
        </form>
        <table border="1">
            <tr>
                <th>이모지 갯수</th>
                <th scope="col" colspan="5">이모지 타입</th>
                <th th:colspan="${result.emojicwt}">이모지 삭제</th>
            </tr>
            <tr>
                <td>[[${result.emojicwt}]]</td>
                <td>😋<span>[[${emojitype1}]]</span></td>
                <td>🥰[[${emojitype2}]]</td>
                <td>😭[[${emojitype3}]]</td>
                <td>😅[[${emojitype4}]]</td>
                <td>🥵[[${emojitype5}]]</td>
                <td th:each="dto : ${emojilist}"><button type="button" th:value="${dto.eno}"
                        class="emojiRemoveBtn">삭제</button></td>
            </tr>
        </table>

        <script th:inline="javascript">
            $("#emojisave").click(function () {
                var id = $("input[name='id']").val();
                var dno = $("input[name='dno']").val();
                var emojitype = $("select[name='emojitype']").val();


                var data = { id: id, dno: dno, emojitype: emojitype };
                var urlemojiregister = `[[@{/dyning/emojiregister}]]`;
                console.log(data);
                $.ajax({
                    url: urlemojiregister + "/" + dno,
                    type: "POST",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "text",
                    success: function (result) {
                        console.log("result: " + result);
                        self.location.reload();
                    }
                })
            });


            $(".emojiRemoveBtn").click(function () {
                var eno = $(this).val();
                var data = { eno: eno };

                console.log(data);
                var urlemojiremove = `[[@{/dyning/emojiremove}]]`;
                $.ajax({
                    url: urlemojiremove + "/" + eno,
                    type: "DELETE",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "text",
                    success: function (result) {
                        console.log("result: " + result);
                        self.location.reload();
                    }
                })
            });
        </script>
    </th:block>
</th:block>