<html lang="ko" xmls:th="http://www.thymeleaf.org">
<style>
    .look {
        display: inline-block;
    }

    /* character look radio */
    #setimg {
        width: 100px;
        height: 140px;
    }

    #setimg:hover {
        cursor: pointer;
    }

    /* character look 미리보기 */
    .setlook {
        width: 100px;
        height: 140px;
    }

    .containerBox {
        max-width: 1000px;
        margin: 0 auto;
        font-family: 'GmarketSansLight';
    }

    .personal-info-container {
        background-color: #f4f4f4;
        border-radius: 5px;
        width: 100%;
        height: 286px;
        display: flex;
        align-items: center;
        justify-content: space-evenly;
    }

    .personal-info-character {
        padding: 15px 57px 30px 57px;
    }

    .personal-info-character-content button {
        width: 162px;
        background-color: #DBE9B7;
        height: 30px;
        border: none;
        border-radius: 20px;
        font-size: 16px;
    }

    .info-div {
        padding: 7px 0 6px 0;
    }

    .personal-info-character-content {
        text-align: center;
        /* border-right: 1px solid black; */
        /* border-right-height: 30px; */

    }

    .personal-info-character img {
        filter: drop-shadow(4px 2px 6px lightgray);
    }

    hr {
        height: 260px !important;
        width: 0.5px !important;
        border-width: 0;
        color: #000;
        background-color: #000;
    }

    .personal-info-content {
        padding: 55px 0 30px 0;
    }

    .personal-info {
        margin: 15px 0 15px 0;
    }

    .personal-info span:last-child {
        margin-left: 17px;
    }

    .info-btns {
        padding: 10px;
        text-align: center;
    }

    #memberModifyBtn {
        text-align: center;
        background-color: #DBE9B7;
        height: 42px;
        border: none;
        border-radius: 7px;
        font-size: 16px;
        width: 63px;

    }

    .info-btns button {
        background-color: #DBE9B7;
        height: 30px;
        border: none;
        border-radius: 20px;
        font-size: 16px;


    }


    .info-btns button:last-child {
        width: 144px;
    }

    .personal-info input {
        width: 223px !important;
        height: 42 !important;
        display: inline-block !important;
        margin: 0 !important;
        margin-left: 15px !important;
    }

    .content-title {
        font-weight: bold;
        border-bottom: 1px solid gray;
        margin: 29px 0;
    }

    .character-list {
        display: inline-block;
        padding: 23px;
    }

    .my-character {
        display: inline-block;
        padding: 0 20px 17px 20px;
    }

    .character-container {
        display: flex;
        justify-content: space-evenly;
        width: 100%;
        height: 265px;
        padding: 20px;
        background-color: #f4f4f4;
        text-align: center;
    }

    .character-container img {
        filter: drop-shadow(3px 1px 4px lightgray);
    }

    .character-container hr {
        height: 160px !important;
        width: 0.5px !important;
        border-width: 0;
        color: #000;
        background-color: #000;
    }

    .my-character-container button {
        background-color: #DBE9B7;
        height: 30px;
        border: none;
        border-radius: 20px;
        font-size: 16px;
        width: 120px;

    }

    .my-character-container p {
        margin: 0 !important;
        font-size: 18px;
    }

    .follow-container {
        display: flex;
        justify-content: space-evenly;
        align-items: center;
        width: 100%;
        flex-wrap: wrap ;
        padding: 10px;
    }
    .follow-content hr{
        margin: 0 !important;
    }

    .follow-content {
        /* align-items: center; */
        display: flex;
        align-items: center;
        width: 100%;
        padding: 15px 10px;
    }

    .follow-title {
        flex-basis: 120px;
        text-align: center;
    }
    .follow-content hr {
        height: 160px !important;
        width: 0.5px !important;
        border-width: 0;
        color: #000;
        background-color: #000;
        margin: 0 30px !important;

    }
    .follow-list{
    }
    .follow-content {
        width: 100%;
    }
</style>
<th:block th:replace="~{layout/basic :: setContent(~{::content})}">
    <th:block th:fragment="content">
        <div class="containerBox">
            <form id="memberfrm" action="">
                <h3 class="py-5" style="font-family: 'GmarketSansMedium';">
                    <img th:src="@{/icon/vertical-line.png}" style="width:30px;" alt="">마이페이지
                </h3>
                <p class="content-title">개인정보</p>
                <div class="personal-info-container">
                    <div class="personal-info-character-content">
                        <div class="personal-info-character">
                            <th:block th:each="sdto : ${setDTO}">
                                <img class="look setlook" th:src="${sdto.setpath}" alt="">
                                <input type="hidden" id="radioset" th:value="${sdto.setname}">
                            </th:block>
                        </div>
                        <div class="info-div">
                            <a href="#setimg"><button type="button">캐릭터 변경하기</button></a>
                        </div>
                        <div class="info-div">
                        </div>
                    </div>
                    <hr>
                    <div class="personal-info-content">
                        <div class="personal-info">
                            <span>아이디</span>
                            <input type="hidden" th:value=${memberDTO.id} name=id readonly>
                            <span><b>[[${memberDTO.id}]]</b></span>
                        </div>
                        <div class="personal-info">
                            <span>닉네임</span>
                            <input type="text" th:value=${memberDTO.nickname} name=nickname class="form-control">
                            <button id="memberModifyBtn" type="button">수정</button>
                        </div>
                        <div class="personal-info">
                            <span>가입일</span>
                            <span><b>[[${#temporals.format(memberDTO.regdate, 'yyyy-MM-dd')}]]</b></span>
                        </div>
                        <div class="info-btns">
                            <button id="memberOutBtn" type="button">회원탈퇴</button>
                        </div>
                    </div>
                </div>
            </form>
            <!-- 캐릭터 -->
            <p class="content-title">캐릭터</p>
            <form id="lookform" action="">
                <div class="character-container">
                    <div class="character-list">
                        <input type="hidden" name="id" th:value="${id}">
                        <span th:each="sdto : ${looklist}">
                            <input hidden type="radio" name="setname" th:id="${sdto.setname}"
                                th:value="${sdto.setname}">
                            <label th:for="${sdto.setname}" th:data-src="${sdto.setpath}">
                                <img th:src="${sdto.setpath}" alt="" id="setimg" />
                            </label>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        </span>
                    </div>
                    <hr>
                    <!-- 현재 내 캐릭터 -->
                    <div class="my-character-container">
                        <div>
                            <p>내 캐릭터</p>
                        </div>
                        <div class="my-character">
                            <div th:each="sdto : ${setDTO}">
                                <img class="look setlook" th:src="${sdto.setpath}" alt="" id="checkedset">
                                <input type="hidden" id="radioset" th:value="${sdto.setname}">
                            </div>
                        </div>
                        <div>
                            <button id="lookModifyBtn" type="button">변경하기</button>
                        </div>
                    </div>
                </div>
            </form>
            <!-- 팔로우 -->
            <p class="content-title">팔로우</p>
            <div class="follow-container">
                <div class="follow-content">
                    <div class="follow-title">
                        <span>작가</span>
                    </div>
                    <hr>
                    <div class="follow-list">
                        <div th:each="adto : ${afollowDTO}" class="follow-info">
                            <input type="hidden" th:value="${adto}" readonly>
                            <span>[[${adto}]]</span>
                            <span class="follow-btn">
                            <button th:value="${memberDTO.id}" type="button" class="artistRemoveBtn">팔로우 취소</button>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="follow-content">
                    <div class="follow-title">
                        <span>가게</span>
                    </div>
                    <hr>
                    <div class="follow-list">
                        <div th:each="ddto : ${dfollowDTO}" class="follow-info">
                            <input type="hidden" name="name" th:value="${ddto}" readonly>
                            <span>[[${ddto}]]</span>
                            <span class="follow-btn">
                            <button class="dyningRemoveBtn" th:value="${memberDTO.id}" type="button">팔로우취소</button>
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            
            <table border="1">
                <tr>
                    <th scope="col">팔로우한 artist</th>
                </tr>
                <tr th:each="adto : ${afollowDTO}">
                    <td>
                        <input type="text" th:value="${adto}" readonly>
                        <button th:value="${memberDTO.id}" type="button" class="artistRemoveBtn">팔로우 취소</button>
                    </td>
                </tr>
            </table>
            <table border="1">
                <tr>
                    <th scope="col">팔로우한 dyning</th>
                </tr>
                <tr th:each="ddto : ${dfollowDTO}">
                    <td><input type="text" name="name" th:value="${ddto}" readonly>
                        <button class="dyningRemoveBtn" th:value="${memberDTO.id}" type="button">팔로우취소</button>
                    </td>
                </tr>
            </table>
            <br>
            <table border="1">
                <tr>
                    <th scope="col">DNO</th>
                    <th scope="col">이모지타입</th>
                    <th scope="col">이모지path</th>
                    <th scope="col">등록날짜</th>
                    <th scope="col">삭제</th>
                </tr>
                <tr th:each="edto : ${emojiDTO}" th:if="${edto.dno}!=0">
                    <td>[[${edto.dno}]]</td>
                    <td>[[${edto.emojitype}]]</td>
                    <td><img th:src="${edto.emojipath}" alt="" / width="30px"></td>
                    <td>[[${edto.regdate}]]</td>
                    <td><button class="emojiRemoveBtn" th:value="${edto.eno}" type="button">삭제</button></td>
                </tr>
            </table>
            <br>
            <table border="1">
                <tr>
                    <th scope="col">GNO</th>
                    <th scope="col">이모지타입</th>
                    <th scope="col">이모지path</th>
                    <th scope="col">등록날짜</th>
                    <th scope="col">삭제</th>
                </tr>
                <tr th:each="edto : ${emojiDTO}" th:if="${edto.gno}!=0">
                    <td>[[${edto.gno}]]</td>
                    <td>[[${edto.emojitype}]]</td>
                    <td><img th:src="${edto.emojipath}" alt="" width="30px"></td>
                    <td>[[${edto.regdate}]]</td>
                    <td><button class="emojiRemoveBtn" th:value="${edto.eno}" type="button">삭제</button></td>
                </tr>
            </table>
        </div>
        <script th:inline="javascript">

            var memberform = document.querySelector("#memberfrm");
            var lookform = document.querySelector("#lookform");
            var dyningfrm = document.querySelector("#dyningfrm");
            var memberModifyBtn = document.querySelector("#memberModifyBtn");
            var lookModifyBtn = document.querySelector("#lookModifyBtn");
            var artistRemoveBtn = document.querySelector("#artistRemoveBtn");
            var dyningRemoveBtn = document.querySelector("#dyningRemoveBtn");

            var radioset = $("#radioset").val();
            $('input:radio[name=setname]:input[value=' + radioset + ']').attr("checked", true);

            $("input[name=setname]").on("change", function () {
                var checkedset = $(this).next().data('src');
                $("#checkedset").attr("src", checkedset);
            });

            /*[+var urlmembermodify = [[@{/main/mypage/membermodify}]];+]*/
            /*[+var urllookmodify = [[@{/main/mypage/lookmodify}]];+]*/
            /*[+var urlartistremove = [[@{/main/mypage/artistremove}]];+]*/
            /*[+var urldyningremove = [[@{/main/mypage/dyningremove}]];+]*/
            /*[+var urlemojiremove = [[@{/main/mypage/emojiremove}]];+]*/
            /*[+var urlmemberout = [[@{/main/mypage/memberremove}]];+]*/

            document.querySelector("#memberModifyBtn").onclick = function () {

                swal({
                    title: "닉네임을 수정하시겠습니까?",
                    text: "OK를 누르면 닉네임이 수정됩니다",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {
                            swal("닉네임이 변경되었습니다", {
                                icon: "success",
                            });
                            memberform.setAttribute("action", urlmembermodify);
                            memberform.setAttribute("method", "post");
                            memberform.submit();
                        } else {
                            swal("닉네임 수정이 취소되었습니다.");
                        }
                    });

            }
            document.querySelector("#lookModifyBtn").onclick = function () {
                swal({
                    title: "캐릭터 옷을 변경하시겠습니까?",
                    text: "OK를 누르면 캐릭터 옷이 변경됩니다",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {
                            swal("캐릭터 옷이 변경되었습니다", {
                                icon: "success",
                            });
                            lookform.setAttribute("action", urllookmodify);
                            lookform.setAttribute("method", "post");
                            lookform.submit();
                        } else {
                            swal("캐릭터 옷 변경이 취소되었습니다.");
                        }
                    });

            }
            document.querySelector("#memberOutBtn").onclick = function () {
                swal({
                    title: "폰크닉 회원을 탈퇴하시겠습니까?",
                    text: "OK를 누르면 회원님의 모든 데이터가 삭제되며, 이 동작은 되돌릴 수 없습니다.",
                    icon: "warning",
                    buttons: true,
                    dangerMode: true,
                })
                    .then((willDelete) => {
                        if (willDelete) {
                            swal("다음에 또 만나요", {
                                icon: "success",
                            });
                            memberform.setAttribute("action", urlmemberout);
                            memberform.setAttribute("method", "post");
                            memberform.submit();
                        } else {
                            swal("회원탈퇴가 취소되었습니다.");
                        }
                    });

            }

            $("#hairchoice").on("change", function () {
                var selectedpath = $("#hairchoice option:selected").next().val();
                $("#selectedhair").val(selectedpath);

            });

            $(".artistRemoveBtn").click(function () {
                var id = $(this).val();
                var artistname = $(this).prev().val();

                var data = { id: id, artistname: artistname };

                console.log(data);

                $.ajax({
                    url: urlartistremove + "/" + id + "/" + artistname,
                    type: "DELETE",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "text",
                    success: function (result) {
                        console.log("result: " + result);
                        self.location.reload();
                    }
                })
            });

            $(".dyningRemoveBtn").click(function () {
                var id = $(this).val();
                var dyningname = $(this).prev().val();

                var data = { id: id, dyningname: dyningname };

                console.log(data);

                $.ajax({
                    url: urldyningremove + "/" + id + "/" + dyningname,
                    type: "DELETE",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "text",
                    success: function (result) {
                        console.log("result: " + result);
                        self.location.reload();
                    }
                })
            });

            $(".emojiRemoveBtn").click(function () {
                var eno = $(this).val();
                var data = { eno: eno };

                console.log(data);

                $.ajax({
                    url: urlemojiremove + "/" + eno,
                    type: "DELETE",
                    data: JSON.stringify(data),
                    contentType: "application/json; charset=utf-8",
                    dataType: "text",
                    success: function (result) {
                        console.log("result: " + result);
                        self.location.reload();
                    }
                })
            });

        </script>
    </th:block>
</th:block>